<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>MyScorer - Archery Scoring App</title>
<link rel="stylesheet" href="style.css" />
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>

<div class="container">

  <!-- Login Screen -->
  <div id="loginPage" class="screen active">
    <h1>üèπ My Scorer üèπ</h1>
    <div>
      <label for="username">Name:</label>
      <input type="text" id="username" placeholder="Enter name" />
    </div>
    <div>
      <label for="email">Email:</label>
      <input type="email" id="email" placeholder="Email Address" />
    </div>
    <input type="password" id="password" placeholder="Password" />
    <select id="role">
      <option value="archer">Archer</option>
      <option value="coach">Coach</option>
    </select>
    <button id="signupBtn">Sign Up</button>
    <button id="loginBtn">Login</button>
    <div id="loginMessage" class="message"></div>
  </div>

  <!-- Welcome / Menu Screen -->
  <div id="menuScreen" class="screen">
    <h1>üèπ My Scorer üèπ</h1>
    <p id="greeting" style="text-align:center; font-size:1rem; margin-bottom: 25px;"></p>
    <button id="menuStartBtn">Start Session</button>
    <button id="menuHistoryBtn">My History</button>
    <button id="menuLogoutBtn">Logout</button>
    <button id="menuToggleBtn">Toggle Theme</button>
  </div>

  <!-- Coach Dashboard -->
  <div id="coachDashboard" class="screen">
    <h2>Coach Dashboard</h2>
    <div id="archerListContainer">
      <h3>Archers</h3>
      <ul id="archerList" style="list-style:none; padding-left:0;"></ul>
    </div>
    <div id="archerSessionsContainer" style="margin-top:20px;">
      <h3>Sessions for <span id="selectedArcherName">Select an archer</span></h3>
      <div id="archerSessionList"></div>
    </div>
    <div id="sessionResultContainer" style="margin-top:20px; display:none;">
      <h3>Session Details</h3>
      <div id="sessionResultSummary"></div>
      <div id="sessionResultTable"></div>
      <canvas id="sessionResultChart" width="400" height="200"></canvas>
      <button id="sessionResultCloseBtn">Close</button>
    </div>
    <button id="coachBackBtn" style="margin-top:20px;">Back to Menu</button>
  </div>

  <!-- Session Setup Screen -->
  <div id="setup" class="screen">
    <h2>Session Setup</h2>
    <label for="bowStyle">Bow Style:</label>
    <select id="bowStyle">
      <option value="Recurve">Recurve</option>
      <option value="Compound">Compound</option>
      <option value="Barebow">Barebow</option>
      <option value="Longbow">Longbow</option>
    </select>

    <label for="distance">Distance (m):</label>
    <select id="distance">
      <option value="10">10</option>
      <option value="18">18</option>
      <option value="30">30</option>
      <option value="50">50</option>
      <option value="70">70</option>
      <option value="90">90</option>
    </select>

    <label for="targetFace">Target Face:</label>
    <select id="targetFace">
      <option value="40cm">40 cm</option>
      <option value="60cm">60 cm</option>
      <option value="80cm">80 cm</option>
      <option value="122cm">122 cm</option>
    </select>

    <label for="arrowsPerEnd">Arrows per End:</label>
    <input type="number" id="arrowsPerEnd" value="6" min="1" max="12" />

    <label for="endsCount">Number of Ends:</label>
    <input type="number" id="endsCount" value="6" min="1" max="30" />

    <button id="startSessionBtn">Start Session</button>
    <button id="viewHistoryBtn">View History</button>
    <button id="logoutBtn">Logout</button>
  </div>

  <!-- Scoring Screen -->
  <div id="scoringArea" class="screen">
    <h2>End <span id="currentEnd">1</span></h2>
    <div id="scoreButtons" style="text-align:center; margin-bottom:10px;"></div>
    <p>Tap score to add arrow</p>
    <div id="endScores"></div>
    <div id="endTotal" style="margin-top:10px; font-weight:bold;">Total: 0</div>
    <button id="undoBtn">Undo Last Arrow</button>
    <button id="nextEndBtn" style="display:none;">Next</button>
    <button id="endSessionBtn" style="display:none;">End Session</button>
  </div>

  <!-- Session Results Screen -->
  <div id="results" class="screen">
    <h2>Session Results</h2>
    <div id="sessionSummary"></div>
    <div id="scoreTable"></div>
    <canvas id="scoreChart" width="400" height="200" style="margin-top: 20px;"></canvas>
    <button id="newSessionBtn">New Session</button>
  </div>

  <!-- History Screen -->
  <div id="historyScreen" class="screen">
    <h2>Session History</h2>
    <div id="historyTable"></div>
    <button id="backToMenuBtn">Back to Menu</button>
  </div>

  <!-- Session Detail Modal -->
  <div id="sessionDetailModal" style="display:none; position:fixed; top:0; left:0; width:100vw; height:100vh; 
        background:rgba(0,0,0,0.8); color:#fff; z-index:1000; align-items:center; justify-content:center;">
    <div style="background:#222; padding:20px; border-radius:10px; max-width:90vw; max-height:80vh; overflow-y:auto; position:relative;">
      <button id="closeDetailButton" style="position:absolute; top:10px; right:10px; background:none; border:none; color:#fff; font-size:24px; cursor:pointer;">&times;</button>
      <div id="sessionDetailContent"></div>
    </div>
  </div>

</div>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script type="module" src="script.js"></script>
<script>
  // Theme toggle implementation
  const themes = ['', 'light-theme', 'redblack-theme']; // '' = original dark

  function getCurrentTheme() {
    return document.body.className;
  }

  function getThemeIndex() {
    return themes.indexOf(getCurrentTheme());
  }

  function applyTheme(index) {
    const theme = themes[index] || '';
    document.body.className = theme;
    localStorage.setItem('selectedTheme', theme);
  }

  function toggleTheme() {
    const currentIndex = getThemeIndex();
    const nextIndex = (currentIndex + 1) % themes.length;
    applyTheme(nextIndex);
  }

  // On page load, apply saved theme if any
  document.addEventListener('DOMContentLoaded', () => {
    const savedTheme = localStorage.getItem('selectedTheme') || '';
    if (themes.includes(savedTheme)) {
      document.body.className = savedTheme;
    }
    // Attach event to toggle button
    const toggleBtn = document.getElementById('menuToggleBtn');
    if (toggleBtn) {
      toggleBtn.addEventListener('click', toggleTheme);
    }
  });
</script>

</body>
</html>
